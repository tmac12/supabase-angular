import{a as ie}from"./chunk-B5JKUC6G.js";import{a as k}from"./chunk-PPD7BVT3.js";import{a as re,c as oe,f as le,n as ae}from"./chunk-BUM5AQCU.js";import{o as ne}from"./chunk-2YWUQ3JB.js";import{Aa as f,B,D as T,Ha as S,J as U,Ob as F,Pa as h,Pb as V,Qb as te,Ua as C,V as p,Va as J,Wa as z,Xa as H,Y as E,Ya as l,Za as o,_a as v,cb as g,da as Y,ea as G,f as D,fb as w,ga as _,gb as d,ha as x,l as I,ma as L,n as O,oa as Q,pb as s,q as $,qb as X,r as W,rb as M,sb as Z,tb as K,ub as ee,wb as y}from"./chunk-46NUIZ3Q.js";import"./chunk-JENGY3ED.js";import{a as q,b as N,d as A}from"./chunk-PYQTE2ZK.js";function ue(e,i){if(e&1){let r=g();l(0,"div",5)(1,"div",5)(2,"label",6),s(3," Email address "),o(),l(4,"div",7)(5,"input",8),ee("ngModelChange",function(n){_(r);let a=d();return K(a.email,n)||(a.email=n),x(n)}),o()()(),l(6,"div")(7,"button",9),w("click",function(){_(r);let n=d();return x(n.addFriend())}),s(8," Add friend "),o(),l(9,"button",9),w("click",function(){_(r);let n=d();return x(n.signIn())}),s(10," Send magic link "),o()()()}if(e&2){let r=d();f(5),Z("ngModel",r.email)}}function pe(e,i){e&1&&(l(0,"div"),s(1,"Please check your emails!"),o())}var se=(()=>{let i=class i{constructor(){this.email=S(""),this.linkSuccess=S(!1),this.authService=p(ie),this.friendService=p(k)}signIn(){return A(this,null,function*(){let t=yield this.authService.signInWithEmail(this.email());t.error?alert(t.error.message):this.linkSuccess.set(!0)})}addFriend(){return A(this,null,function*(){let t=yield this.friendService.addFriendByEmail(this.email());alert(t?"Friend added":"Friend not added")})}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=E({type:i,selectors:[["app-add-friend"]],standalone:!0,features:[y],decls:8,vars:1,consts:[[1,"min-h-full","flex","flex-col","justify-center","py-12","sm:px-6","lg:px-8"],[1,"sm:mx-auto","sm:w-full","sm:max-w-md"],[1,"mt-6","text-center","text-3xl","font-extrabold","text-gray-900"],[1,"mt-8","sm:mx-auto","sm:w-full","sm:max-w-md"],[1,"bg-white","py-8","px-4","shadow","sm:rounded-lg","sm:px-10"],[1,"space-y-6"],["for","email",1,"block","text-sm","font-medium","text-gray-700"],[1,"mt-1"],["type","email","autocomplete","email","placeholder","friend email address",1,"block","w-full","px-3","py-2","border","border-gray-300","rounded-md","shadow-sm","placeholder-gray-400","focus:outline-none","focus:ring-emerald-500","focus:border-emerald-500","sm:text-sm",3,"ngModelChange","ngModel"],[1,"w-full","flex","justify-center","py-2","px-4","border","border-transparent","rounded-md","shadow-sm","text-sm","font-medium","text-white","bg-emerald-600","hover:bg-emerald-700","focus:outline-none","focus:ring-2","focus:ring-offset-2","focus:ring-emerald-500",3,"click"]],template:function(n,a){n&1&&(l(0,"div",0)(1,"div",1)(2,"h2",2),s(3," Add friend "),o()(),l(4,"div",3)(5,"div",4),h(6,ue,11,1,"div",5)(7,pe,2,0),o()()()),n&2&&(f(6),C(6,a.linkSuccess()?7:6))},dependencies:[ae,re,oe,le]});let e=i;return e})();function ce(e,i,r){!i&&G(e);let t=i??p(L);return r?Y(t,r):t}function j(e,i={}){return ce(j,i?.injector,()=>{let r=p(Q),t=new D,a=xe(t,i?.behavior??"switch").subscribe({next:c=>m.set({kind:u.Value,value:c}),error:c=>m.set({kind:u.Error,error:c})});r.onDestroy(()=>a.unsubscribe());let m;if(i?.requireSync&&i?.initialValue===void 0){let c=e(void 0);if(de(c))throw new Error(fe);m=S({kind:u.NoValue}),I(c)?t.next(c):m.set({kind:u.Value,value:c})}else m=S({kind:u.Value,value:i?.initialValue});if(i?.requireSync&&m().kind===u.NoValue)throw new Error(_e);let P=i?.requireSync===!0;return te(()=>{let c=V(()=>{let R=m();return R.kind===u.Value?R.value:void 0}),b=e(c);if(P){P=!1;return}I(b)||de(b)?V(()=>t.next(b)):V(()=>m.set({kind:u.Value,value:b}))}),F(()=>{let c=m();switch(c.kind){case u.Value:return c.value;case u.Error:throw c.error;case u.NoValue:return;default:throw new Error("Unknown state")}},{equal:i?.equal})})}var fe="Promises cannot be used with requireSync. Pass an initialValue or set requireSync to false.",_e="The observable passed to computedAsync() did not emit synchronously. Pass an initialValue or set requireSync to false.";function xe(e,i){let r={merge:$,concat:W,exhaust:B,switch:U};return e.pipe(r[i]())}function de(e){return e&&typeof e.then=="function"}var u=function(e){return e[e.NoValue=0]="NoValue",e[e.Value=1]="Value",e[e.Error=2]="Error",e}(u||{});function he(e,i){if(e&1&&(l(0,"span",9),s(1),o()),e&2){let r=d().$implicit;f(),M(" ",r.status," ")}}function Ce(e,i){if(e&1&&s(0),e&2){let r=d().$implicit;M(" ",r.status," ")}}function Se(e,i){if(e&1){let r=g();l(0,"div")(1,"button",10),w("click",function(){_(r);let n=d(2).$implicit,a=d(2);return x(a.acceptFriendship(n.id))}),s(2," ACCEPT "),o(),l(3,"button",11),w("click",function(){_(r);let n=d(2).$implicit,a=d(2);return x(a.declineFriendShip(n.id))}),s(4," DECLINE "),o()()}}function ve(e,i){if(e&1&&h(0,Se,5,0),e&2){let r,t=d().$implicit;C(0,(r=t.status)==="pending"?0:-1)}}function we(e,i){if(e&1&&(l(0,"tr")(1,"th")(2,"label"),v(3,"input",2),o()(),l(4,"td")(5,"div",3)(6,"div",4)(7,"div",5),v(8,"img",6),o()(),l(9,"div")(10,"div",7),s(11),o(),l(12,"div",8),s(13,"email"),o()()()(),l(14,"td"),h(15,he,2,1)(16,Ce,1,1),o(),l(17,"th"),h(18,ve,1,1),o()()),e&2){let r,t=i.$implicit;f(11),X(t.email),f(4),C(15,(r=t.status)==="accepted"?15:16),f(3),C(18,t.isOwner?18:-1)}}function be(e,i){if(e&1&&z(0,we,19,3,"tr",null,J),e&2){let r=d();H(r.friendsVm())}}var Ye=(()=>{let i=class i{constructor(){this.friendService=p(k),this.accountService=p(ne),this.allFriends=j(()=>this.friendService.getAllFriends().pipe(O(t=>{if(t.error)return console.error("Error fetching friends",t.error),[];let n=new Set,a=t.data;return Array.isArray(a)?a.filter(m=>n.has(m.owner_id)?!1:(n.add(m.owner_id),!0)):[]})),{initialValue:[]}),this.friendsVm=F(()=>{let t=this.allFriends();if(!t)return[];let n=this.accountService.userId();return t.map(a=>N(q({},a),{isOwner:a.owner_id===n}))})}acceptFriendship(t){console.log("accept friend"),this.friendService.acceptFriendShip(t).pipe(T()).subscribe()}declineFriendShip(t){console.log("decline friend"),this.friendService.declineFriendShip(t).pipe(T()).subscribe()}};i.\u0275fac=function(n){return new(n||i)},i.\u0275cmp=E({type:i,selectors:[["app-friends"]],standalone:!0,features:[y],decls:17,vars:1,consts:[[1,"overflow-x-auto"],[1,"table"],["type","checkbox",1,"checkbox"],[1,"flex","items-center","gap-3"],[1,"avatar"],[1,"mask","mask-squircle","w-12","h-12"],["src","/tailwind-css-component-profile-2@56w.png","alt","Avatar Tailwind CSS Component"],[1,"font-bold"],[1,"text-sm","opacity-50"],[1,"text-green-500"],[1,"btn","btn-success","btn-xs",3,"click"],[1,"btn","btn-error","btn-xs",3,"click"]],template:function(n,a){n&1&&(v(0,"app-add-friend"),l(1,"h1"),s(2,"All Friends"),o(),l(3,"div",0)(4,"table",1)(5,"thead")(6,"tr")(7,"th")(8,"label"),v(9,"input",2),o()(),l(10,"th"),s(11,"Email"),o(),l(12,"th"),s(13,"Status"),o(),v(14,"th"),o()(),l(15,"tbody"),h(16,be,2,0),o()()()),n&2&&(f(16),C(16,a.friendsVm()?16:-1))},dependencies:[se]});let e=i;return e})();export{Ye as default};
